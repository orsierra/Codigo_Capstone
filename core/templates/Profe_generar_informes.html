<!DOCTYPE html>
<html lang="es">
<head>
    <title>Informe de Alumnos</title>
</head>
<body>
    <h1>Informe de Alumnos - {{ curso.nombre }}</h1>

    <ul>
        {% for alumno in alumnos %}
        <li>
            {{ alumno.nombre }} {{ alumno.apellido }}
            <button data-alumno-id="{{ alumno.id }}">Generar Informe</button>
        </li>
        {% endfor %}
    </ul>

    <script>
        const cursoId = {{ curso.id }};

        document.querySelectorAll('button').forEach(button => {
            button.addEventListener('click', () => {
                const alumnoId = button.dataset.alumnoId;

                fetch('/generar_pdf/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        alumno_id: alumnoId,
                        curso_id: cursoId
                    })
                })
                .then(response => response.blob())
                .then(blob => {
                    const url = window.URL.createObjectURL(blob);
                    const link = document.createElement('a');
                    link.href = url;
                    link.setAttribute('download', `informe_${alumnoId}.pdf`);
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Error al generar el informe. Por favor, inténtalo de nuevo más tarde.');
                });
            });
        });
    </script>
</body>
</html>